<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Termo de Ciência e Responsabilidade – Trilheiros de Rondonópolis</title>
<style>
body { font-family: Arial; background:#0b0b0b; color:#fff; padding:20px; text-align:center; }
h1 { color:#fff; }
.box { max-width:700px; margin:auto; background:#151515; padding:20px; border-radius:10px; text-align:left; }
input { padding:10px; margin:5px 0; width:100%; border-radius:6px; border:none; }
button { padding:12px 20px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin-top:10px; background:#25D366; color:#fff; }
button:disabled { background:#444; color:#999; cursor:not-allowed; }
.status { margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<div class="box">
<h1>Termo de Ciência e Responsabilidade – Trilha Morro da Mesa</h1>
<p><strong>Data do passeio:</strong> 23 de novembro</p>

<form id="termoForm">
<label>Nome completo:</label>
<input type="text" id="nome" placeholder="Digite seu nome completo" required>

<label>WhatsApp:</label>
<input type="text" id="whatsapp" placeholder="Digite seu WhatsApp (ex: 5599999999999)" required>

<div>
<input type="checkbox" id="aceite"> Eu declaro que participarei da trilha/passeio por minha livre vontade, estou ciente dos riscos e isento os organizadores de qualquer responsabilidade.
</div><br>

<button type="submit" id="entrarBtn">Enviar e Entrar no Grupo</button>
</form>

<p class="status" id="status">Verificando vagas disponíveis...</p>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx2eQenBBxT1vR3mD65XOv_4Y0GUIjVt3pLt8ISJl43dGTFC57Ljl6T4XzOYXIk__Gx/exec";
const JOIN_LINK = "https://chat.whatsapp.com/GOReIoh8N0ZCa4pQh2IMy7";
const MAX_PARTICIPANTES = 75;
const statusEl = document.getElementById("status");
const entrarBtn = document.getElementById("entrarBtn");

async function verificarVagas() {
    const resp = await fetch(`${SCRIPT_URL}?action=getTotal`);
    const total = await resp.text();
    const restantes = MAX_PARTICIPANTES - parseInt(total);
    if(restantes <= 0){
        statusEl.textContent = "Grupo fechado - limite atingido.";
        entrarBtn.disabled = true;
    } else {
        statusEl.textContent = `${restantes} vagas restantes.`;
        entrarBtn.disabled = false;
    }
}

document.getElementById("termoForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const nome = document.getElementById("nome").value.trim();
    const whatsapp = document.getElementById("whatsapp").value.trim();
    const aceite = document.getElementById("aceite").checked;
    if(!nome || !whatsapp || !aceite){ alert("Preencha todos os campos e aceite o termo."); return; }

    const resp = await fetch(`${SCRIPT_URL}?action=registrar&nome=${encodeURIComponent(nome)}&whatsapp=${encodeURIComponent(whatsapp)}`);
    const text = await resp.text();
    if(text === "FECHADO"){
        alert("Limite de participantes atingido. Grupo fechado.");
        statusEl.textContent = "Grupo fechado - limite atingido.";
        entrarBtn.disabled = true;
        return;
    }

    // Mensagem automática para WhatsApp
    const msg = encodeURIComponent(`Olá, meu nome é ${nome}. Aceitei o termo de responsabilidade para a trilha Morro da Mesa em 23/11. Quero participar da trilha.`);
    window.open(`https://wa.me/${whatsapp}?text=${msg}`, "_blank");

    // Limpar formulário
    document.getElementById("nome").value = "";
    document.getElementById("whatsapp").value = "";
    document.getElementById("aceite").checked = false;

    verificarVagas();
});

verificarVagas();
</script>

</body>
</html>

