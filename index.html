<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trilha Morro da Mesa 23 de novembro - Trilheiros de Rondonópolis</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(180deg, #000000, #111111);
    color: #fff;
    margin: 0;
    padding: 20px;
    text-align: center;
}
h1 {
    font-size: 2.3em;
    margin-bottom: 5px;
    color: #fff;
    text-shadow: 0 0 10px #28a745;
}
h2 {
    font-size: 1.4em;
    margin-bottom: 20px;
    color: #fff;
    text-shadow: 0 0 8px #28a745;
}
.box {
    max-width: 750px;
    margin: auto;
    background: #111;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,255,0,0.5);
}
input[type="text"] {
    padding: 12px;
    margin: 10px 0;
    width: 95%;
    border-radius: 8px;
    border: none;
    font-size: 1em;
}
.termo {
    width: 95%;
    height: 320px;
    padding: 12px;
    margin: 15px 0;
    border-radius: 8px;
    border: none;
    background: #222;
    color: #fff;
    resize: none;
    overflow-y: scroll;
    font-size: 0.95em;
}
button {
    padding: 18px 30px;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    background: #28a745;
    color: #fff;
    font-size: 1.2em;
    margin-top: 15px;
    width: 95%;
    transition: 0.3s ease;
}
button:hover:not(:disabled) {
    background: #1e7e34;
    transform: scale(1.05);
}
button:disabled {
    background: #444;
    color: #999;
    cursor: not-allowed;
}
.checkbox-label {
    display: block;
    margin: 15px 0;
    font-size: 1.1em;
    cursor: pointer;
}
#alertaLotado {
    background: #b30000;
    color: white;
    padding: 12px;
    font-weight: bold;
    font-size: 1.1em;
    border-radius: 8px;
    margin-bottom: 15px;
    display: none;
}
@media(max-width:600px){
    .termo {
        height: 250px;
    }
    button {
        font-size: 1em;
        padding: 14px 20px;
    }
    h1 {
        font-size: 2em;
    }
    h2 {
        font-size: 1.15em;
    }
}
</style>
</head>
<body>

<div class="box" id="mainBox">

<div id="alertaLotado">Grupo lotado. Inscrição encerrada.</div>

<h1>Trilha Morro da Mesa 23 de novembro</h1>
<h2>Trilheiros de Rondonópolis</h2>

<form id="reservaForm">
<input type="text" id="nome" placeholder="Digite seu nome completo" required><br>

<textarea class="termo" readonly>
TERMO DE RESPONSABILIDADE E INSTRUÇÕES

O percurso tem nível médio a difícil com trechos íngremes e escorregadios. É obrigatório o uso de calçados apropriados, roupas confortáveis, protetor solar e água.

É proibido usar caixas de som ou consumir bebidas alcoólicas. Qualquer violação poderá resultar na retirada do participante.

Todos devem preservar o meio ambiente, não deixar lixo e seguir as orientações do guia.

A organização poderá afastar qualquer pessoa que coloque em risco o grupo ou o andamento do passeio.

A organização não se responsabiliza por acidentes causados por imprudência ou falta de preparo físico.

O passeio poderá ser cancelado ou adiado em caso de mau tempo.

É indispensável estar em boas condições de saúde. Pessoas com problemas cardíacos, respiratórios, mobilidade reduzida ou histórico de desmaios não devem participar.

Participantes sem preparo físico devem avaliar os riscos antes de confirmar presença.

Menores de catorze anos não poderão participar.

Declaro que estou ciente dos riscos e isento os organizadores de qualquer responsabilidade decorrente da atividade.
</textarea>

<label class="checkbox-label">
<input type="checkbox" id="aceite"> Li e aceito o termo de responsabilidade
</label>

<button type="submit" id="enviarBtn" disabled>Entrar no grupo do WhatsApp</button>
</form>

</div>

<script>
// CONFIGURAÇÕES
const JOIN_LINK = "https://chat.whatsapp.com/GOReIoh8N0ZCa4pQh2IMy7";
const MAX_PARTICIPANTES = 75;
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz9m_YrXZ3pCNTsqnBX9XuNuTIINjQ0ErPpmkUyU9FkkYKv9bI5fWP2w93Ui9VjA1hs8Q/exec";

const nomeInput = document.getElementById("nome");
const aceiteCheckbox = document.getElementById("aceite");
const enviarBtn = document.getElementById("enviarBtn");
const alerta = document.getElementById("alertaLotado");

// Verifica se pode habilitar botão
function checkForm() {
    enviarBtn.disabled = !aceiteCheckbox.checked || !nomeInput.value.trim();
}

aceiteCheckbox.addEventListener("change", checkForm);
nomeInput.addEventListener("input", checkForm);

// Checa limite no servidor
async function verificarLimite() {
    try {
        const resp = await fetch(WEBAPP_URL);
        const data = await resp.json();
        const total = data.total;

        if (total >= MAX_PARTICIPANTES) {
            enviarBtn.disabled = true;
            alerta.style.display = "block";
            return true;
        } else {
            alerta.style.display = "none";
            checkForm();
            return false;
        }
    } catch (err) {
        console.error(err);
        return true;
    }
}

// Envio
document.getElementById("reservaForm").addEventListener("submit", async e => {
    e.preventDefault();

    const lotado = await verificarLimite();
    if (lotado) {
        alert("O grupo atingiu o limite de participantes.");
        return;
    }

    try {
        await fetch(WEBAPP_URL, {
            method: "POST",
            body: new URLSearchParams({ nome: nomeInput.value })
        });
        window.open(JOIN_LINK, "_blank");
    } catch (err) {
        console.error(err);
    }
});

// Atualização periódica
verificarLimite();
setInterval(verificarLimite, 5000);
</script>

</body>
</html>
