<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trilha Morro da Mesa - 23 de Novembro</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    margin: 0;
    padding: 20px;
    text-align: center;
}
.box {
    background: #111;
    padding: 30px;
    border-radius: 15px;
    max-width: 600px;
    margin: auto;
    box-shadow: 0 0 20px rgba(0,255,0,0.5);
}
h1 {
    font-size: 2.4em;
    margin-bottom: 10px;
    text-shadow: 0 0 10px #28a745;
}
h2 {
    font-size: 1.4em;
    margin-bottom: 20px;
    color: #ccc;
}
input, textarea {
    width: 100%;
    padding: 16px;
    font-size: 1.2em;
    border: none;
    border-radius: 10px;
    margin-top: 12px;
    box-sizing: border-box;
}
textarea {
    height: 280px;
    background: #222;
    color: #fff;
    resize: none;
}
label {
    display: block;
    margin-top: 20px;
    font-size: 1.2em;
}
button {
    width: 100%;
    padding: 20px;
    border: none;
    border-radius: 10px;
    margin-top: 20px;
    background: #28a745;
    color: #fff;
    font-size: 1.3em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
button:disabled {
    background: #444;
    color: #999;
    cursor: not-allowed;
}
button:hover:not(:disabled) {
    transform: scale(1.05);
    background: #1e7e34;
}
#alertaLotado {
    background: #c40000;
    padding: 20px;
    border-radius: 12px;
    color: #fff;
    font-weight: bold;
    font-size: 1.5em;
    display: none;
    margin-bottom: 20px;
    box-shadow: 0 0 15px rgba(255,0,0,0.7);
}
#mensagemErro {
    color: #ff4444;
    font-weight: bold;
    margin-top: 10px;
    font-size: 1.2em;
}
@media (max-width: 500px) {
    h1 { font-size: 2em; }
    h2 { font-size: 1.2em; }
    input, textarea, button { font-size: 1.2em; padding: 14px; }
    label { font-size: 1.1em; }
    button {
        position: sticky;
        bottom: 10px;
        z-index: 10;
    }
}
</style>
</head>
<body>

<div class="box">
<h1>Trilha Morro da Mesa</h1>
<h2>23 de Novembro - Trilheiros de Rondonópolis</h2>

<div id="alertaLotado">⚠️ Grupo lotado! As 75 vagas foram preenchidas.</div>

<textarea readonly>
- O percurso tem nível médio a avançado, com trechos íngremes e escorregadios.
- É obrigatório o uso de calçados adequados, água, protetor solar e roupas confortáveis.
- É proibido o uso de caixas de som para preservar o ambiente.
- O participante deve respeitar a natureza, não deixar lixo e seguir as orientações do guia.
- A organização não se responsabiliza por acidentes causados por imprudência ou desrespeito às regras.
- Em caso de condições climáticas adversas, o passeio poderá ser cancelado ou adiado.
- É indispensável estar em boas condições de saúde para participar da trilha.
- Pessoas com problemas cardíacos, respiratórios, mobilidade reduzida ou com histórico de desmaios/síncopes não são orientadas a realizar essa atividade.
- Participantes sedentários ou sem preparo físico devem avaliar cuidadosamente os riscos antes de confirmar presença.
- Crianças menores de 14 anos não serão permitidas.
</textarea>

<label for="nome">Nome completo</label>
<input type="text" id="nome" placeholder="Digite seu nome completo">

<label>
<input type="checkbox" id="aceite"> Confirmo que li e aceito o termo de responsabilidade
</label>

<button id="entrarBtn" disabled>
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" width="24" height="24">
    Entrar no grupo do WhatsApp
</button>
<div id="mensagemErro"></div>

</div>

<script>
const JOIN_LINK = "https://chat.whatsapp.com/GOReIoh8N0ZCa4pQh2IMy7";
const MAX_PARTICIPANTES = 75;
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz9m_YrXZ3pCNTsqnBX9XuNuTIINjQ0ErPpmkUyU9FkkYKv9bI5fWP2w93Ui9VjA1hs8Q/exec";

const nomeInput = document.getElementById("nome");
const aceite = document.getElementById("aceite");
const botao = document.getElementById("entrarBtn");
const alerta = document.getElementById("alertaLotado");
const mensagemErro = document.getElementById("mensagemErro");

function validar() {
    const nomeOk = nomeInput.value.trim().length > 3;
    const aceito = aceite.checked;
    botao.disabled = !(nomeOk && aceito);
}

nomeInput.addEventListener("input", validar);
aceite.addEventListener("change", validar);

async function verificarStatus() {
    try {
        const r = await fetch(WEBAPP_URL);
        const data = await r.json();

        if (data.total >= MAX_PARTICIPANTES) {
            botao.disabled = true;
            alerta.style.display = "block";
            mensagemErro.textContent = "Infelizmente o grupo já atingiu o limite de participantes.";
        } else {
            alerta.style.display = "none";
            mensagemErro.textContent = "";
        }
    } catch (e) {
        console.log("Erro ao verificar limite", e);
    }
}

botao.addEventListener("click", async () => {
    await verificarStatus();
    if (botao.disabled) return;

    const nome = nomeInput.value.trim();

    try {
        const resp = await fetch(WEBAPP_URL, {
            method: "POST",
            body: new URLSearchParams({ nome })
        });

        const resultado = await resp.json();

        if (resultado.erro === "duplicado") {
            mensagemErro.textContent = "Este nome já está inscrito.";
            return;
        }

        alert("Cadastro realizado com sucesso! Você será direcionado para o grupo.");
        window.open(JOIN_LINK, "_blank");

    } catch (e) {
        mensagemErro.textContent = "Erro ao enviar dados. Tente novamente.";
    }
});

verificarStatus();
setInterval(verificarStatus, 30000);
</script>

</body>
</html>
